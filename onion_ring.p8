pico-8 cartridge // http://www.pico-8.com
version 39
__lua__
function _init()
  init_player()
  init_enemi()
end

function _update60()
    update_player()
    update_enemi()
end

function _draw()
 cls(6)
 palt(6, true)
 palt(0, false)
 spr(32,player.x, player.y,1,2)
 map(0,0)
	draw_enemi()
	draw_player()
end

-->8
-- enemi

function init_enemi()
	enemis = {}
 create_enemi(40,40)
end


function create_enemi(x, y)
	enemi = 
		{
			x=x,
			y=y,
			speed=0.3,
			oriented=0,
			timer = 40,
			sprite = 42,
			reverse = false
		}
	add(enemis, enemi)
end

function update_enemi()
	for e in all(enemis) do
		e.timer -= 1
		if(e.timer == 0) then
			e.timer = 40
		end
		deplacer_enemi(e)
	end
end

function deplacer_enemi(e)
	local angle = atan2((player.y-e.y),player.x-e.x)
	e.x = e.x + (e.speed * sin(angle))
	e.y = e.y + (e.speed * cos(angle))
 e.reverse = sin(angle) > 0
end


function draw_enemi()
 for e in all(enemis) do
  local decalage = 2
  if(e.timer%3 == 2) then
   if(e.sprite == 42) then
   	e.sprite = 43
   else
    e.sprite = 42
   end
  end
  if(e.timer < 10) decalage = 3
  spr(e.sprite,e.x,e.y + decalage,1,1,e.reverse)
 	spr(41,e.x,e.y,1,1,e.reverse)
 end
end
-->8
-- utilitaire

function collision(a,b)
	return not (a.x>b.x+8
												 or a.y>b.y+8
												 or a.x+8<b.x
												 or a.y+8<b.y)
end
-->8
-- player

function init_player()
     
  player =
  {
   x=60,
   y=60,
   speed=1,
   timer=40,
   life=100,
   invincible=false,
   sprite=1,
   mov=false,
   reverse = false 
  }
end

function change_pos()
    if(btn(⬆️)) player.y-=player.speed
    if(btn(⬇️)) player.y+=player.speed
    if(btn(⬅️)) player.x-=player.speed
    if(btn(➡️)) player.x+=player.speed
end

function change_orientation()
    player.mov = false
	   if(btn(⬆️) or btn(⬇️)) player.mov = true
    if(btn(⬅️)) then
        player.reverse = true
        player.mov = true
    elseif(btn(➡️)) then
        player.reverse = false
        player.mov = true
        
    end  
end

function animation()
 if(player.mov and player.timer % 6 ==0) then
 	player.sprite += 1
 	if(player.sprite == 4) player.sprite = 1
 end
 if(not player.mov) player.sprite = 1
end

function update_player()
    change_pos()
    change_orientation()
    player.timer -=1
    if(player.timer == 0) player.timer = 40
end

function draw_player()
 spr(player.sprite,player.x, player.y,1,2,player.reverse)
 animation()
end
__gfx__
0000000066366666b636666666366666000000000000000000000000000000000000000066666666666646660000000000000000000000000000000000000000
000000000033600bb033630b0033600b000000000000000000000000000000000000000066666666666646660000000000000000000000000000000000000000
00700700b33030bbbb3030bbbb030bbb000000000000000000000000000000000000000066666666666646660000000000000000000000000000000000000000
0007700060330bb660b30bb660330b06000000000000000000000000000000000000000066686666666643660000000000000000000000000000000000000000
000770006b030b066b0b0b066b030b060000000000000000000000000000000000000000666b46666b6643660000000000000000000000000000000000000000
007007006bb0bb666b0bbb666bb0bb660000000000000000000000000000000000000000663b336663b434660000000000000000000000000000000000000000
00000000600000066000000660000006000000000000000000000000000000000000000066633666663434660000000000000000000000000000000000000000
00000000044044060440440604404406000000000000000000000000000000000000000066666666664433660000000000000000000000000000000000000000
00000000044844860448448604484486000000000000000000000000000000000000000066666666666443660000000000000000000000000000000000000000
000000000440440604404406044044060000000000000000000000000000000000000000666666666664433b0000000000000000000000000000000000000000
00000000600000066000000660000006000000000000000000000000000000000000000066666666666443660000000000000000000000000000000000000000
00000000604444666044444660444466000000000000000000000000000000000000000066666666666444660000000000000000000000000000000000000000
00000000604004066040000460400046000000000000000000000000000000000000000066656666b66344660000000000000000000000000000000000000000
000000000000000600000006000000060000000000000000000000000000000000000000666356663b6364660000000000000000000000000000000000000000
0000000066666666666666666666666600000000000000000000000000000000000000006653236663b334460000000000000000000000000000000000000000
00000000666666666666666666666666000000000000000000000000000000000000000066653666664434460000000000000000000000000000000000000000
66366666663666660000000000000000000000000000000000000000000000000000000066666666666666666666666600000000000000000000000000000000
003360030033600000000000000000000000000000000000000000000000000000000000649a9666666666666666666600000000000000000000000000000000
3303033333030333000000000000000000000000000000000000000000000000000000004449a966666666666666666600000000000000000000000000000000
60330306603333060000000000000000000000000000000000000000000000000000000061d1d92965552f66d5552fff00000000000000000000000000000000
63030306630303060000000000000000000000000000000000000000000000000000000062f2f96a65552df665552d6600000000000000000000000000000000
6330336663303366000000000000000000000000000000000000000000000000000000004f499666d552226f6552226600000000000000000000000000000000
60000006600000060000000000000000000000000000000000000000000000000000000044499666655444665554446600000000000000000000000000000000
04040406040404060000000000000000000000000000000000000000000000000000000044496666556665666666665600000000000000000000000000000000
04848406048484060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04040406040404060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60000006600000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66444466664444660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
64000046640000460000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60000006404404040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666664664660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
9999999999999999999999999999b999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
999999a9999993999999999999999999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999999999999999999999999999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999993999999999999999999999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999999999999999999999999999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b999999999999999999999999a999999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
39999b9999999a999939999999999999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999999999999999999999999999999999990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
45454454cc45cc54c545c454ccccccc44ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
44ccc4ccc4ccc4ccccccccc4ccccccc55ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5cccccccccccccccccccccc5ccccccc45ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4cccccccccccccccccccccc4ccccccc54ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
54ccccccc4ccccccc4ccccc5ccccccc54ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4ccccccccccccccccccc4cc4ccccccc45ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5cccccccccccccccccccccc5ccccccc54ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5cccccccccccccccccccccc4ccccccc55ccccccc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ccccccccccccccccccccccc5cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5cccccccccccccccccccccc4cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5cccccccccccccccccccccc4cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4cccccccccccccccccccccc5cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4cccccccccccccccccccccc4cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4c4ccccccc4cccccccccccc5cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ccccccc4ccccccc4ccccccc4cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
455c45c4455c45c4455c45c4cccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4044444444444444444444444444444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444444444444440444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444424244444444444444444044444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4440424244444444444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4440424244444444444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444044444444444343424400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444444444444443434400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444445051515244444442434400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444445463635344444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444446061616244444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444040404443444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444440404044434444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444443444441434444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444443434343444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444441414144444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4444444444444444444444444444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
